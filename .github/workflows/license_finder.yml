# Run License Finder

name: license_finder

on:
  #pull_request:
  #  types: [ opened, reopened ]
  #push:
  #  # Trigger on any branch push
  #  branches:
  #    - '**'  # Match any branch
  workflow_dispatch:
    branches:
      - '**'  # Match any branch
  workflow_call:

# Setting environment variables which can be used in the entire workflow (only in the current one)
env:
  # Used for build_docker job
  CONTAINER_REGISTRY: registry.gitlab.com

jobs:
  license_finder:
    runs-on: 'ubuntu-latest'
    steps:

      # Checking out the GitHub repository on the runner
    - name: Checkout
      uses: 'actions/checkout@8ade135a41bc03ea155e62e844d188df1ea18608'

      # Uses the `docker/login-action` action to log in to the Container registry registry using the account and password that will publish the packages. Once published, the packages are scoped to the account defined here.
    - name: Log in to the Container registry
      uses: docker/login-action@65b78e6e13532edd9afa3aa52ac7964289d1a9c1
      with:
        registry: ${{ env.CONTAINER_REGISTRY }}
        username: ${{ vars.LICENSE_FINDER_GITLAB_REGISTRY_USERNAME }}
        password: ${{ secrets.LICENSE_FINDER_GITLAB_REGISTRY_PASSWORD }}


      # Uses github action to pull docker image and run commands
    - name: Run the build process with Docker
      uses: 'addnab/docker-run-action@4f65fabd2431ebc8d299f8e5a018d79a769ae185'
      with:
        username: ${{ vars.LICENSE_FINDER_GITLAB_REGISTRY_USERNAME }}
        password: ${{ secrets.LICENSE_FINDER_GITLAB_REGISTRY_PASSWORD }}
        registry: ${{ env.CONTAINER_REGISTRY }}
        image: crosslend/docker/license-finder/main:latest
        run: |
          license_finder --help

